{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "Composition",
    "description": "File format that defines a collection of tunings to be used in a musical composition. The player is expected to switch between the tuning while playing the composition.",
    "type": "object",
    "properties": {
        "$schema": {
            "type": "string",
            "format": "uri-reference"
        },
        "metadata": { "$ref": "compositionMetadata.schema.json" },
        "intonationStandard": { "$ref": "intonationStandard.schema.json" },
        "tuningReference": { "$ref": "tuningReference.schema.json" },
        "baseUri": {
            "type": "string",
            "title": "Base URI",
            "description": "Custom base URI to be used for all internal URIs in this file.",
            "format": "uri-reference"
        },
        "definitions": {
            "type": "object",
            "title": "Definitions",
            "properties": {
                "scales": {
                    "type": "object",
                    "title": "Scale Definitions",
                    "patternProperties": {
                        "^[\\w\\-_]+$": { "$ref": "scale-inContext.schema.json" }
                    },
                    "unevaluatedProperties": false
                },
                "tunings": {
                    "type": "object",
                    "title": "Tuning Definitions",
                    "patternProperties": {
                        "^[\\w\\-_]+$": { "$ref": "tuningSpec.schema.json" }
                    },
                    "unevaluatedProperties": false
                }
            },
            "unevaluatedProperties": false
        },
        "tunings": {
            "type": "array",
            "title": "Tunings",
            "description": "An array of tuning specifications, where each one allows a scale to be mapped to a keyboard tuning.",
            "items": { "$ref": "tuningMapper.schema.json" }
        },
        "globalFill": {
            "$comment": "TODO Haven't decided if we should call this default or global!",
            "allOf": [
                {
                    "title": "Global Fill",
                    "description": "Fallback tuning to be used for unused keyboard keys.\nIt is applied globally, for all tunings that have unused keys, by using the tuning values. If this fallback itself, does not define tuning values for some unused keys, then, the standard 12-EDO tuning values are used for those keys (values with a deviation of 0 cents). If the defaultFill is not provided, unused keys will use the standard 12-EDO tuning."
                },
                { "$ref": "tuningSpec.schema.json" }
            ]
        },
        "tuningReducer": { "$ref": "tuningReducer.schema.json" },
        "settings": {
            "type": "object",
            "properties": {
                "tuningMapper": {
                    "type": "object",
                    "properties": {
                        "manual": {
                            "$ref": "tuningMapper.schema.json#/$defs/manualSettings",
                            "unevaluatedProperties": false
                        },
                        "auto": {
                            "$ref": "tuningMapper.schema.json#/$defs/autoSettings",
                            "unevaluatedProperties": false
                        }
                    },
                    "unevaluatedProperties": false
                },
                "tuningReducer": {
                    "type": "object",
                    "properties": {
                        "merge": {
                            "$ref": "tuningReducer.schema.json#/$defs/mergeSettings",
                            "unevaluatedProperties": false
                        }
                    },
                    "unevaluatedProperties": false
                }
            },
            "unevaluatedProperties": false
        }
    },
    "required": ["tuningReference", "tunings"],
    "unevaluatedProperties": false
}
